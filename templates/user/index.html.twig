{% extends 'base.html.twig' %}

{% block title %}Profil de {{ user.name }}{% endblock %}

{% block body %}
<div class="user-container">
    <!-- Header avec nom de profil -->
    <div class="user-header">
        <div class="user-profile">
            <h1>{{ user.name }}</h1>
            <p class="user-email">{{ user.email }}</p>
        </div>
    </div>
     <div class="page-header">
            <a href="{{ path('app_bag_new') }}" class="btn-add">Ajouter un nouveau sac</a>
     </div>

    <!-- Section des articles publiés -->
    <div class="user-content">
        <div class="articles-section">
            
            <h2>Mes sacs publiés</h2>
            
            {% if bags is not empty %}
                <div class="articles-list">
                    
                    {% for bag in bags %}
                        <div class="article-item">
                            <div class="article-info">
                                <h3 class="article-name">{{ bag.name }}</h3>
                                <p class="article-date">Publié le {{ bag.createdAt|date('d/m/Y à H:i') }}</p>
                            </div>
                            <div class="article-actions">
                                {% if bag.status.name is same as ('indisponible') %}
                               
                                <a href="{{ path('app_borrow_return', {'id': bag.id}) }}" class="btn-edit" 
                                   onclick="return confirm('Êtes-vous sûr de vouloir rendre cet article ?')">
                                    Retour du sac
                                </a>
                                 {% endif %}

                                <a href="{{ path('app_bag_edit', {'id': bag.id}) }}" class="btn-edit">
                                    Modifier
                                </a>
                                
                                <!-- Formulaire de suppression avec token CSRF -->
                                <form method="post" action="{{ path('app_bag_delete', {'id': bag.id}) }}" style="display: inline;">
                                    <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ bag.id) }}">
                                    <button type="submit" class="btn-delete" 
                                            onclick="return confirm('Êtes-vous sûr de vouloir supprimer cet article ?')">
                                        Supprimer
                                    </button>
                                </form>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="no-articles">
                    <p>Vous n'avez pas encore publié de sac.</p>
                    <a href="{{ path('app_bag_new') }}" class="btn-add-first">Publier votre premier sac</a>
                </div>
            {% endif %}
        </div>
    </div>
        <div class="user-content">
            <div class="articles-section">
                <h2>Demandes d'emprunt de mes sacs</h2>

             {% if requestedBags is not empty %}
                 {% for bag in requestedBags %}
                    <div class="article-actions">
                        <p>{{ bag.name }} demandé par {{  bag.borrower ? bag.borrower.name : 'Utilisateur inconnu'  }}</p>
                            <form method="post" action="{{ path('app_borrow_accept', {'id': bag.id}) }}">
                                <button class="btn-edit" type="submit">Accepter</button>
                        </form>
                             <form method="post" action="{{ path('app_borrow_refuse', {'id': bag.id}) }}">
                                <button class='btn-delete' type="submit">Refuser</button>
                        </form>
                    </div> 
                 {% endfor %}
            {% else %}
            <p class="no-articles">Aucune demande d'emprunt pour vos sacs.</p>
            {% endif %} 
         </div>
    </div>

    <div class="user-content">
        <div class="articles-section">
            <h2>Les sacs empruntés</h2>
            {% if borrowedBags is not empty %}
                <div class="articles-list">
                    {% for bag in borrowedBags %}
                        {% if bag.status.name is same as ('indisponible') %}
                        <div class="article-item">
                            <div class="article-info">
                                <h3 class="article-name">{{ bag.name }}</h3>
                                <p class="article-owner">Propriétaire: {{ bag.owner.name }}</p>
                            </div>
                            <div class="article-actions">
                                <a href="{{ path('app_bag_show', {'id': bag.id}) }}" class="btn-edit">
                                    Voir
                                </a>
                            </div>
                        </div>
                         {% endif %}
                    {% endfor %}
                </div>
            {% else %}
                <div class="no-articles">
                    <p>Vous n'avez aucun emprunt en cours.</p>
                    <a href="{{ path('app_bag_index') }}" class="btn-add-first">Voir tous les sacs</a>
                </div>
            {% endif %}
        </div>
    </div>
{% endblock %}